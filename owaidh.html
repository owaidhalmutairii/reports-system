<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e5a3e 0%, #2d7a54 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .login-title {
            font-size: 24px;
            font-weight: bold;
            color: #1e5a3e;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #1e5a3e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .login-btn:hover {
            background: #15472f;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            display: none;
        }

        .container.active {
            display: block;
        }
        
        .header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }

        .logout-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 15px;
            background: #e8f5e9;
            color: #1e5a3e;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
        }
        
        .main-title {
            font-size: 26px;
            font-weight: bold;
            color: #1e5a3e;
            margin-bottom: 8px;
        }

        .sub-title {
            font-size: 16px;
            color: #2d7a54;
            font-weight: 600;
            margin: 5px 0;
        }

        .dept-title {
            font-size: 14px;
            color: #666;
            margin: 3px 0;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .tab.active {
            background: #1e5a3e;
            color: white;
        }
        
        .content-area {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
        }
        
        .content-area.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-weight: bold;
            color: #1e5a3e;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-input:disabled {
            background: #f0f0f0;
        }
        
        .form-textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .location-selector {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .location-btn {
            flex: 1;
            padding: 15px;
            border: 3px solid #1e5a3e;
            background: white;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #1e5a3e;
            cursor: pointer;
        }

        .location-btn.active {
            background: #1e5a3e;
            color: white;
        }
        
        .item-box {
            border: 2px solid #1e5a3e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9fdf9;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .item-num {
            background: #1e5a3e;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .item-title {
            flex: 1;
            font-weight: 600;
            color: #1e5a3e;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .checkbox-label input {
            width: 20px;
            height: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #1e5a3e;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .report-card {
            background: #f9fdf9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-right: 4px solid #1e5a3e;
            cursor: pointer;
        }
        
        .report-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .report-title {
            font-size: 16px;
            font-weight: bold;
            color: #1e5a3e;
            margin-bottom: 5px;
        }
        
        .report-info {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .location-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e8f5e9;
            color: #1e5a3e;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            margin-top: 8px;
        }

        .status-open {
            background: #fff3cd;
            color: #856404;
        }

        .status-closed {
            background: #d4edda;
            color: #155724;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .wo-action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }

        .wo-btn-create {
            background: #1e5a3e;
            color: white;
        }

        .wo-btn-close {
            background: #28a745;
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .section-title {
            color: #1e5a3e;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f5e9;
        }

        .images-section {
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }

        .file-upload {
            border: 2px dashed #1e5a3e;
            border-radius: 6px;
            padding: 8px;
            font-size: 13px;
            width: 100%;
            margin-bottom: 10px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 12px;
            margin-top: 20px;
        }

        .log-entry {
            background: #f9fdf9;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-right: 3px solid #1e5a3e;
        }

        .log-time {
            font-size: 12px;
            color: #666;
        }

        .log-action {
            font-weight: bold;
            color: #1e5a3e;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <div class="login-title">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
        <div style="text-align:center;margin-bottom:20px;">
            <div style="font-size:14px;color:#1e5a3e;font-weight:bold;">ÙØ±Ø¹ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© Ø¨Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†</div>
        </div>
        <input type="password" class="login-input" id="passwordInput" placeholder="ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <input type="text" class="login-input" id="usernameInput" placeholder="ğŸ‘¤ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
        <button class="login-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        <div style="margin-top:20px;font-size:12px;color:#666;">
            ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: <strong>MOH2025</strong>
        </div>
    </div>

    <div class="container" id="mainSystem">
        <div class="header">
            <button class="logout-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
            <div class="user-info">ğŸ‘¤ <span id="currentUser"></span></div>
            <div class="main-title">ğŸ“‹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
            <div class="sub-title">ÙØ±Ø¹ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© Ø¨Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†</div>
            <div class="dept-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø© - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø³Ø§Ù†Ø¯</div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showPage('new')">ğŸ“ ØªÙ‚Ø±ÙŠØ±</button>
            <button class="tab" onclick="showPage('list')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="tab" onclick="showPage('workorders')">ğŸ”§ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ù…Ù„</button>
            <button class="tab" onclick="showPage('logs')">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„</button>
            <button class="tab" onclick="showPage('settings')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>
        
        <div class="content-area active" id="page-new">
            <h3 class="section-title">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
            
            <div id="successMsg" class="success-msg" style="display: none;">
                âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!
            </div>

            <form id="reportForm" onsubmit="saveReport(event)">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" class="form-input" id="date" disabled>
                </div>

                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù‚Ø§Ø¦Ù…ÙˆÙ† Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø© *</label>
                    <div class="form-grid">
                        <input type="text" class="form-input" id="person1" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø£ÙˆÙ„" required>
                        <input type="text" class="form-input" id="person2" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ" required>
                        <input type="text" class="form-input" id="person3" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø«Ø§Ù„Ø«" required>
                    </div>
                </div>

                <div class="location-selector">
                    <button type="button" class="location-btn active" onclick="selectLocation('inside', event)">
                        ğŸ¢ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¨Ù†Ù‰
                    </button>
                    <button type="button" class="location-btn" onclick="selectLocation('outside', event)">
                        ğŸŒ³ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¨Ù†Ù‰
                    </button>
                </div>

                <input type="hidden" id="selectedLocation" value="inside">
                
                <h4 class="section-title">Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                
                <div id="itemsContainer"></div>
                
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
                </div>
            </form>
        </div>
        
        <div class="content-area" id="page-list">
            <h3 class="section-title">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
            <div id="reportsList"></div>
        </div>
        
        <div class="content-area" id="page-workorders">
            <h3 class="section-title">ğŸ”§ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ù…Ù„</h3>
            <div id="workOrdersList"></div>
        </div>

        <div class="content-area" id="page-logs">
            <h3 class="section-title">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
            <div id="logsList"></div>
        </div>

        <div class="content-area" id="page-settings">
            <h3 class="section-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            
            <div class="form-group">
                <label class="form-label">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                <input type="password" class="form-input" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                <button class="btn btn-primary" style="margin-top:10px;" onclick="changePassword()">ØªØ­Ø¯ÙŠØ«</button>
            </div>

            <div class="form-group" style="margin-top:30px;">
                <label class="form-label">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…ÙŠÙ† Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</label>
                <div class="form-grid">
                    <input type="text" class="form-input" id="defaultPerson1" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø£ÙˆÙ„">
                    <input type="text" class="form-input" id="defaultPerson2" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ">
                    <input type="text" class="form-input" id="defaultPerson3" placeholder="Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø«Ø§Ù„Ø«">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label>
                <input type="email" class="form-input" id="contractorEmail" placeholder="contractor@company.com">
            </div>

            <div class="form-group">
                <label class="form-label">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Ù„Ø¥ØºÙ„Ø§Ù‚ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ù…Ù„)</label>
                <input type="email" class="form-input" id="supervisorEmail" placeholder="supervisor@moh.gov.sa">
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>ØªØ·ÙˆÙŠØ± ÙˆØªØµÙ…ÙŠÙ…: Ø¹ÙˆÙŠØ¶ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ Â© 2025</p>
    </div>

    <script>
        const DEFAULT_PASSWORD = 'MOH2025';
        let currentUser = '';

        const itemsInside = ['Ù†Ø¸Ø§ÙØ© Ù…Ù…Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ù†Ù‰','Ù†Ø¸Ø§ÙØ© Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙŠØ§Ù‡','Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§ØªØ¨ ÙˆØ§Ù„ØºØ±Ù','ØªÙˆÙØ± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµØ­ÙŠØ©','Ù†Ø¸Ø§ÙØ© Ø§Ù„Ø£Ø«Ø§Ø« ÙˆØ§Ù„Ù…ÙƒØ§ØªØ¨','Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…Ø¨Ù†Ù‰','Ø§Ù„ØªÙƒÙŠÙŠÙ','Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„Ø²ÙŠ','Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦','Ù„ÙˆØ­Ø§Øª Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©','Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù…ØµØ§Ø¹Ø¯','ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨'];
        const itemsOutside = ['Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©','Ù†Ø¸Ø§ÙØ© Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª','Ù†Ø¸Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø§Ø¦Ù‚','Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ù','Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©','Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù…Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©','ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø±ØµÙØ©','ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù‚Ù…Ø§Ù…Ø©','Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ','Ø§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª'];

        window.onload = async function() {
            const loggedIn = sessionStorage.getItem('moh_loggedIn');
            const username = sessionStorage.getItem('moh_username');
            
            if (loggedIn === 'true' && username) {
                currentUser = username;
                document.getElementById('currentUser').textContent = currentUser;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainSystem').classList.add('active');
                setTodayDate();
                await loadSettings();
                createItems('inside');
                setupCheckboxes();
            }
        };

        async function login() {
            const password = document.getElementById('passwordInput').value;
            const username = document.getElementById('usernameInput').value.trim();

            if (!username) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }

            const savedPassword = await getStorageData('system_password');
            const correctPassword = savedPassword || DEFAULT_PASSWORD;

            if (password !== correctPassword) {
                alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
                await addLog(username, 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©');
                return;
            }

            currentUser = username;
            sessionStorage.setItem('moh_loggedIn', 'true');
            sessionStorage.setItem('moh_username', username);
            
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainSystem').classList.add('active');
            
            await addLog(username, 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„');
            
            setTodayDate();
            await loadSettings();
            createItems('inside');
            setupCheckboxes();
        }

        function logout() {
            addLog(currentUser, 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬');
            sessionStorage.clear();
            location.reload();
        }

        async function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            
            if (!newPassword || newPassword.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            await saveStorageData('system_password', newPassword);
            await addLog(currentUser, 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±');
            
            alert('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±');
            document.getElementById('newPassword').value = '';
        }

        async function getStorageData(key) {
            try {
                const result = await window.storage.get(key, true);
                return result ? JSON.parse(result.value) : null;
            } catch (e) {
                return null;
            }
        }

        async function saveStorageData(key, value) {
            try {
                await window.storage.set(key, JSON.stringify(value), true);
                return true;
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', e);
                return false;
            }
        }

        async function addLog(user, action) {
            try {
                const logs = await getStorageData('activity_logs') || [];
                logs.unshift({
                    user: user,
                    action: action,
                    timestamp: new Date().toISOString()
                });
                
                if (logs.length > 100) logs.length = 100;
                
                await saveStorageData('activity_logs', logs);
            } catch (e) {
                console.error('Ø®Ø·Ø£:', e);
            }
        }

        function selectLocation(location, event) {
            event.preventDefault();
            document.querySelectorAll('.location-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('selectedLocation').value = location;
            createItems(location);
            setupCheckboxes();
        }

        function createItems(location) {
            const container = document.getElementById('itemsContainer');
            const items = location === 'inside' ? itemsInside : itemsOutside;
            let html = '';
            
            items.forEach((item, i) => {
                const num = i + 1;
                html += '<div class="item-box"><div class="item-header"><div class="item-num">' + num + '</div><div class="item-title">' + item + '</div><div class="checkbox-group"><label class="checkbox-label"><input type="checkbox" name="item' + num + '" value="yes"> Ù†Ø¹Ù…</label><label class="checkbox-label"><input type="checkbox" name="item' + num + '" value="no"> Ù„Ø§</label></div></div><div class="form-group"><label class="form-label">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label><textarea class="form-textarea" id="notes' + num + '"></textarea></div><div class="images-section"><label class="form-label">ğŸ“¸ Ø§Ù„ØµÙˆØ± (Ø­ØªÙ‰ 3):</label><input type="file" accept="image/*" id="img' + num + '_1" class="file-upload"><input type="file" accept="image/*" id="img' + num + '_2" class="file-upload"><input type="file" accept="image/*" id="img' + num + '_3" class="file-upload"></div></div>';
            });
            
            container.innerHTML = html;
        }

        function setupCheckboxes() {
            setTimeout(() => {
                const location = document.getElementById('selectedLocation').value;
                const itemsCount = location === 'inside' ? itemsInside.length : itemsOutside.length;
                
                for (let i = 1; i <= itemsCount; i++) {
                    const boxes = document.querySelectorAll('input[name="item' + i + '"]');
                    boxes.forEach(box => {
                        box.addEventListener('change', function() {
                            if (this.checked) {
                                boxes.forEach(b => {
                                    if (b !== this) b.checked = false;
                                });
                            }
                        });
                    });
                }
            }, 100);
        }

        function showPage(page) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('page-' + page).classList.add('active');
            
            if (page === 'list') loadReports();
            if (page === 'workorders') loadWorkOrders();
            if (page === 'logs') loadLogs();
        }

        async function saveReport(e) {
            e.preventDefault();
            
            const location = document.getElementById('selectedLocation').value;
            const items = location === 'inside' ? itemsInside : itemsOutside;
            
            for (let i = 1; i <= items.length; i++) {
                const checked = document.querySelector('input[name="item' + i + '"]:checked');
                if (!checked) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯!\nØ§Ù„Ø¨Ù†Ø¯ Ø±Ù‚Ù… ' + i + ' Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡.');
                    return;
                }
            }
            
            const reportItems = [];

            for (let i = 1; i <= items.length; i++) {
                const checked = document.querySelector('input[name="item' + i + '"]:checked');
                
                const item = {
                    number: i,
                    title: items[i-1],
                    result: checked ? (checked.value === 'yes' ? 'âœ“ Ù†Ø¹Ù…' : 'âœ— Ù„Ø§') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    notes: document.getElementById('notes' + i).value,
                    images: []
                };
                
                for (let j = 1; j <= 3; j++) {
                    const imgInput = document.getElementById('img' + i + '_' + j);
                    if (imgInput && imgInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            item.images.push(event.target.result);
                        };
                        reader.readAsDataURL(imgInput.files[0]);
                    }
                }
                
                reportItems.push(item);
            }

            const report = {
                id: Date.now(),
                date: document.getElementById('date').value,
                person1: document.getElementById('person1').value,
                person2: document.getElementById('person2').value,
                person3: document.getElementById('person3').value,
                location: location,
                locationText: location === 'inside' ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¨Ù†Ù‰' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¨Ù†Ù‰',
                items: reportItems,
                createdAt: new Date().toISOString(),
                createdBy: currentUser
            };

            setTimeout(async () => {
                let reports = await getStorageData('moh_reports') || [];
                reports.unshift(report);
                await saveStorageData('moh_reports', reports);
                
                await addLog(currentUser, 'Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± - ' + report.date);

                document.getElementById('successMsg').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('successMsg').style.display = 'none';
                    resetForm();
                    showPageDirect('list');
                }, 2000);
            }, 500);
        }

        function showPageDirect(page) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            const pages = ['new', 'list', 'workorders', 'logs', 'settings'];
            const index = pages.indexOf(page);
            if (index >= 0 && tabs[index]) tabs[index].classList.add('active');
            
            document.getElementById('page-' + page).classList.add('active');
            
            if (page === 'list') loadReports();
            if (page === 'workorders') loadWorkOrders();
            if (page === 'logs') loadLogs();
        }

        function resetForm() {
            document.getElementById('reportForm').reset();
            setTodayDate();
            loadSettings();
            selectLocationDirect('inside');
        }

        function selectLocationDirect(location) {
            document.querySelectorAll('.location-btn').forEach(btn => btn.classList.remove('active'));
            const btns = document.querySelectorAll('.location-btn');
            if (location === 'inside' && btns[0]) btns[0].classList.add('active');
            else if (btns[1]) btns[1].classList.add('active');
            document.getElementById('selectedLocation').value = location;
            createItems(location);
            setupCheckboxes();
        }

        async function loadReports() {
            const list = document.getElementById('reportsList');
            const reports = await getStorageData('moh_reports') || [];

            if (reports.length === 0) {
                list.innerHTML = '<div class="empty-state"><div style="font-size:40px;">ğŸ“‹</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ±</p></div>';
                return;
            }

            let html = '';
            reports.forEach((r, i) => {
                html += '<div class="report-card" onclick="viewReport(' + i + ')"><div class="report-title">ğŸ“„ ØªÙ‚Ø±ÙŠØ± ' + r.date + '</div><div class="report-info">ğŸ‘¥ ' + r.person1 + ', ' + r.person2 + ', ' + r.person3 + '</div><div class="location-badge">' + r.locationText + '</div><div style="margin-top:5px;font-size:11px;color:#666;">âœï¸ ' + (r.createdBy || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '</div></div>';
            });

            list.innerHTML = html;
        }

        async function viewReport(index) {
            const reports = await getStorageData('moh_reports') || [];
            const r = reports[index];
            
            let html = '<h3 class="section-title">ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3><div style="background:#f9fdf9;padding:15px;border-radius:8px;margin-bottom:15px;"><p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ' + r.date + '</p><p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ' + r.locationText + '</p><p><strong>Ø§Ù„Ù‚Ø§Ø¦Ù…ÙˆÙ†:</strong> ' + r.person1 + ', ' + r.person2 + ', ' + r.person3 + '</p><p style="margin-top:10px;color:#666;"><strong>âœï¸ Ø¨ÙˆØ§Ø³Ø·Ø©:</strong> ' + (r.createdBy || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '</p></div><h4 class="section-title">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h4>';

            r.items.forEach(item => {
                const color = item.result.includes('Ù†Ø¹Ù…') ? '#155724' : item.result.includes('Ù„Ø§') ? '#721c24' : '#666';
                const showBtn = item.result.includes('Ù„Ø§');
                
                html += '<div class="item-box"><div class="item-header"><div class="item-num">' + item.number + '</div><div class="item-title">' + item.title + '</div><div style="font-weight:bold;color:' + color + ';">' + item.result + '</div></div>';
                
                if (item.notes) html += '<div style="background:white;padding:10px;border-radius:6px;margin-top:8px;"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ' + item.notes + '</div>';
                
                if (item.images && item.images.length > 0) {
                    html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:10px;">';
                    item.images.forEach(img => {
                        html += '<img src="' + img + '" style="width:100%;border-radius:8px;border:2px solid #1e5a3e;">';
                    });
                    html += '</div>';
                }
                
                if (showBtn) html += '<div style="margin-top:10px;"><button class="wo-action-btn wo-btn-create" onclick="createWorkOrder(' + index + ', ' + item.number + ')">ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¹Ù…Ù„</button></div>';
                
                html += '</div>';
            });

            html += '<div class="button-group"><button class="btn btn-secondary" onclick="loadReports()">â†©ï¸ Ø±Ø¬ÙˆØ¹</button><button class="btn btn-primary" onclick="printReport(' + index + ')">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button></div>';

            document.getElementById('reportsList').innerHTML = html;
        }

        async function createWorkOrder(reportIndex, itemNumber) {
            const reports = await getStorageData('moh_reports') || [];
            const report = reports[reportIndex];
            const item = report.items.find(i => i.number === itemNumber);
            
            const settings = await getStorageData('moh_settings') || {};
            const contractorEmail = settings.contractorEmail;
            
            if (!contractorEmail) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                showPageDirect('settings');
                return;
            }

            const workOrder = {
                id: Date.now(),
                reportId: report.id,
                reportDate: report.date,
                itemNumber: itemNumber,
                itemTitle: item.title,
                location: report.locationText,
                notes: item.notes,
                images: item.images || [],
                createdAt: new Date().toISOString(),
                deadline: new Date(Date.now() + 72 * 60 * 60 * 1000).toISOString(),
                status: 'open',
                createdBy: currentUser
            };

            let workOrders = await getStorageData('moh_workorders') || [];
            workOrders.unshift(workOrder);
            await saveStorageData('moh_workorders', workOrders);

            await addLog(currentUser, 'Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¹Ù…Ù„ #' + workOrder.id);

            const deadlineDate = new Date(workOrder.deadline);
            const details = 'Ø£Ù…Ø± Ø¹Ù…Ù„ Ø±Ù‚Ù…: ' + workOrder.id + '\n\nğŸ“‹ Ø§Ù„ØªÙØ§ØµÙŠÙ„:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ' + report.date + '\nğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ' + report.locationText + '\nğŸ”§ Ø§Ù„Ø¨Ù†Ø¯: ' + item.title + '\nğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ' + (item.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯') + '\n\nâ° Ù…Ø¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°: 72 Ø³Ø§Ø¹Ø©\nğŸ“† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ' + deadlineDate.toLocaleString('ar-SA') + '\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nØ¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„: ' + contractorEmail;

            try {
                await navigator.clipboard.writeText(details);
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ ÙˆÙ†Ø³Ø® Ø§Ù„ØªÙØ§ØµÙŠÙ„!');
            } catch (e) {
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„!\nØ¥ÙŠÙ…ÙŠÙ„: ' + contractorEmail);
            }
            
            showPageDirect('workorders');
        }

        async function loadWorkOrders() {
            const list = document.getElementById('workOrdersList');
            const workOrders = await getStorageData('moh_workorders') || [];

            if (workOrders.length === 0) {
                list.innerHTML = '<div class="empty-state"><div style="font-size:40px;">ğŸ”§</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ø¹Ù…Ù„</p></div>';
                return;
            }

            let html = '';
            const now = new Date();

            workOrders.forEach((wo, i) => {
                const deadline = new Date(wo.deadline);
                const isExpired = now > deadline && wo.status === 'open';
                const hoursLeft = Math.max(0, Math.round((deadline - now) / (1000 * 60 * 60)));
                
                let badge = '';
                if (wo.status === 'closed') badge = '<span class="status-badge status-closed">âœ“ Ù…ØºÙ„Ù‚</span>';
                else if (isExpired) badge = '<span class="status-badge status-expired">âš ï¸ Ù…Ù†ØªÙ‡ÙŠ</span>';
                else badge = '<span class="status-badge status-open">â±ï¸ Ù…ØªØ¨Ù‚ÙŠ ' + hoursLeft + ' Ø³Ø§Ø¹Ø©</span>';

                html += '<div class="report-card" onclick="viewWorkOrder(' + i + ')"><div class="report-title">ğŸ”§ Ø£Ù…Ø± #' + wo.id + '</div><div class="report-info">ğŸ“ ' + wo.itemTitle + '<br>ğŸ“… ' + wo.reportDate + '<br>ğŸ‘¤ ' + wo.createdBy + '</div>' + badge;
                
                if (wo.closedBy) html += '<div style="margin-top:5px;font-size:12px;color:#155724;">âœ“ ' + wo.closedBy + '</div>';
                
                html += '</div>';
            });

            list.innerHTML = html;
        }

        async function viewWorkOrder(index) {
            const workOrders = await getStorageData('moh_workorders') || [];
            const wo = workOrders[index];
            const settings = await getStorageData('moh_settings') || {};
            const supervisorEmail = settings.supervisorEmail || '';
            
            const deadline = new Date(wo.deadline);
            const now = new Date();
            const isExpired = now > deadline && wo.status === 'open';
            const hoursLeft = Math.max(0, Math.round((deadline - now) / (1000 * 60 * 60)));

            let html = '<h3 class="section-title">ğŸ”§ Ø£Ù…Ø± Ø¹Ù…Ù„ #' + wo.id + '</h3><div style="background:#f9fdf9;padding:15px;border-radius:8px;margin-bottom:15px;"><p><strong>ğŸ“ Ø§Ù„Ø¨Ù†Ø¯:</strong> ' + wo.itemTitle + '</p><p><strong>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ' + wo.reportDate + '</p><p><strong>ğŸ¢ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ' + wo.location + '</p><p><strong>ğŸ‘¤ Ø¨ÙˆØ§Ø³Ø·Ø©:</strong> ' + wo.createdBy + '</p><p><strong>â° Ø§Ù„Ù…Ø¯Ø©:</strong> 72 Ø³Ø§Ø¹Ø©</p><p><strong>ğŸ“† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> ' + deadline.toLocaleString('ar-SA') + '</p>';
            
            if (wo.notes) html += '<p><strong>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ' + wo.notes + '</p>';
            
            html += '<p><strong>ğŸ”” Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ' + (wo.status === 'closed' ? 'âœ“ Ù…ØºÙ„Ù‚' : isExpired ? 'âš ï¸ Ù…Ù†ØªÙ‡ÙŠ' : 'â±ï¸ Ù…ØªØ¨Ù‚ÙŠ ' + hoursLeft + ' Ø³Ø§Ø¹Ø©') + '</p>';
            
            if (wo.closedBy) html += '<p><strong>âœ“ Ø£ØºÙ„Ù‚ Ø¨ÙˆØ§Ø³Ø·Ø©:</strong> ' + wo.closedBy + ' - ' + new Date(wo.closedAt).toLocaleString('ar-SA') + '</p>';
            
            html += '</div>';

            if (wo.images && wo.images.length > 0) {
                html += '<h4 class="section-title">ğŸ“¸ Ø§Ù„ØµÙˆØ±</h4><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;">';
                wo.images.forEach(img => {
                    html += '<img src="' + img + '" style="width:100%;border-radius:8px;border:3px solid #1e5a3e;">';
                });
                html += '</div>';
            }

            html += '<div class="button-group"><button class="btn btn-secondary" onclick="loadWorkOrders()">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>';
            
            if (wo.status === 'open') {
                html += '<button class="wo-action-btn wo-btn-close" onclick="closeWorkOrder(' + index + ')">âœ“ Ø¥ØºÙ„Ø§Ù‚</button>';
            }
            
            html += '</div>';

            document.getElementById('workOrdersList').innerHTML = html;
        }

        async function closeWorkOrder(index) {
            const settings = await getStorageData('moh_settings') || {};
            const supervisorEmail = settings.supervisorEmail;
            
            if (!supervisorEmail) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                showPageDirect('settings');
                return;
            }

            const enteredEmail = prompt('ğŸ” Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø£Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:');
            
            if (!enteredEmail) return;

            if (enteredEmail.toLowerCase().trim() !== supervisorEmail.toLowerCase().trim()) {
                alert('âŒ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­');
                return;
            }

            let workOrders = await getStorageData('moh_workorders') || [];
            workOrders[index].status = 'closed';
            workOrders[index].closedAt = new Date().toISOString();
            workOrders[index].closedBy = currentUser;
            
            await saveStorageData('moh_workorders', workOrders);
            await addLog(currentUser, 'Ø¥ØºÙ„Ø§Ù‚ Ø£Ù…Ø± #' + workOrders[index].id);
            
            alert('âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„');
            loadWorkOrders();
        }

        async function loadLogs() {
            const list = document.getElementById('logsList');
            const logs = await getStorageData('activity_logs') || [];

            if (logs.length === 0) {
                list.innerHTML = '<div class="empty-state"><div style="font-size:40px;">ğŸ“œ</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</p></div>';
                return;
            }

            let html = '';
            logs.forEach(log => {
                const date = new Date(log.timestamp);
                html += '<div class="log-entry"><div class="log-time">ğŸ• ' + date.toLocaleString('ar-SA') + '</div><div class="log-action">ğŸ‘¤ ' + log.user + ': ' + log.action + '</div></div>';
            });

            list.innerHTML = html;
        }

        async function printReport(index) {
            const reports = await getStorageData('moh_reports') || [];
            const r = reports[index];
            
            let content = '<!DOCTYPE html><html dir="rtl"><head><meta charset="UTF-8"><title>ØªÙ‚Ø±ÙŠØ± ' + r.date + '</title><style>body{font-family:Arial;padding:20px}h1,h2{color:#1e5a3e;text-align:center}table{width:100%;border-collapse:collapse;margin:20px 0}td{padding:8px;border:1px solid #ddd}.item{margin:10px 0;padding:10px;border:1px solid #1e5a3e}</style></head><body><h1>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1><h2>ÙØ±Ø¹ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© Ø¨Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†</h2><p style="text-align:center">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø© - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø³Ø§Ù†Ø¯</p><table><tr><td><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong></td><td>' + r.date + '</td></tr><tr><td><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong></td><td>' + r.locationText + '</td></tr><tr><td><strong>Ø§Ù„Ù‚Ø§Ø¦Ù…ÙˆÙ†:</strong></td><td>' + r.person1 + ', ' + r.person2 + ', ' + r.person3 + '</td></tr></table><h3>Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h3>';

            r.items.forEach(item => {
                content += '<div class="item"><strong>' + item.number + '. ' + item.title + '</strong><br>Ø§Ù„Ù†ØªÙŠØ¬Ø©: ' + item.result + (item.notes ? '<br>Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ' + item.notes : '') + '</div>';
            });

            content += '</body></html>';

            const w = window.open('', '', 'height=600,width=800');
            w.document.write(content);
            w.document.close();
            w.print();
        }

        async function saveSettings() {
            const settings = {
                defaultPerson1: document.getElementById('defaultPerson1').value,
                defaultPerson2: document.getElementById('defaultPerson2').value,
                defaultPerson3: document.getElementById('defaultPerson3').value,
                contractorEmail: document.getElementById('contractorEmail').value,
                supervisorEmail: document.getElementById('supervisorEmail').value
            };

            await saveStorageData('moh_settings', settings);
            await addLog(currentUser, 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            await loadSettings();
        }

        async function loadSettings() {
            const settings = await getStorageData('moh_settings') || {};
            
            document.getElementById('defaultPerson1').value = settings.defaultPerson1 || '';
            document.getElementById('defaultPerson2').value = settings.defaultPerson2 || '';
            document.getElementById('defaultPerson3').value = settings.defaultPerson3 || '';
            document.getElementById('contractorEmail').value = settings.contractorEmail || '';
            document.getElementById('supervisorEmail').value = settings.supervisorEmail || '';
            
            document.getElementById('person1').value = settings.defaultPerson1 || '';
            document.getElementById('person2').value = settings.defaultPerson2 || '';
            document.getElementById('person3').value = settings.defaultPerson3 || '';
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }
    </script>
</body>
</html>